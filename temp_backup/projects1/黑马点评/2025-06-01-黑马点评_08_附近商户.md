---
title: "黑马点评_08_附近商户"
date: 2025-06-01 08:08:08 +0800
categories: [JAVA后端项目, 黑马点评]
tags: [分布式, Redis]
pin: false
toc: true
math: true
---

## S (Situation - 情景):

App 需要一个“附近美食”的功能，即根据用户当前的地理位置，查找并展示周边的商户，并按距离排序。传统数据库使用经纬度进行范围查询和距离计算非常复杂且效率低下。

## T (Task - 任务):

利用 Redis 高效实现根据地理坐标查询附近商户的功能。

## A (Action - 行动):

1. 选择数据结构： 使用 Redis 3.2+版本提供的 GEO 地理位置类型。
2. 数据预处理： 将商铺数据按类型（如美食、娱乐）进行分组。将同一类型的商铺的地理位置信息（经度、纬度、商铺 ID）通过 GEOADD 命令存入同一个 GEO Key 中，例如 shop:geo:{typeId}。
3. 查询逻辑：

   - 当用户请求附近商户时，前端上传用户当前的经纬度（x, y）、商户类型 ID 和分页信息（current page）。
   - 后端使用 GEOSEARCH 命令（新版）或 GEORADIUS 命令（旧版），以用户坐标为中心，指定一个半径（如 5000 米），在对应的 shop:geo:{typeId}中进行搜索。
   - 命令会返回范围内的商铺 ID 列表以及各自与用户的距离，并且已经按距离从近到远排好序。
   - 后端根据分页参数，从返回的结果列表中截取对应页的数据，再根据 ID 列表去数据库查询完整的商户信息，最后返回给前端。

## R (Result - 结果):

基于 Redis GEO，实现了高性能的附近商户搜索功能。所有复杂的地理位置计算和排序都在 Redis 中高效完成，响应速度远超传统数据库方案。
