---
title: Java字符串
date: 2024-06-02 06:00:00 +0800
categories: [Daily Coding, Coding Tips, Java字符串]
tags: [Java字符串]
toc: true
math: true
pin: false
render_with_liquid: false
image:
  path: https://cdn.jsdelivr.net/gh/Zong-Liang/blog_images/blog/2024/daily_coding/20251123143645077.png
  lqip: data:image/webp;base64,UklGRpoAAABXRUJQVlA4WAoAAAAQAAAADwAABwAAQUxQSDIAAAARL0AmbZurmr57yyIiqE8oiG0bejIYEQTgqiDA9vqnsUSI6H+oAERp2HZ65qP/VIAWAFZQOCBCAAAA8AEAnQEqEAAIAAVAfCWkAALp8sF8rgRgAP7o9FDvMCkMde9PK7euH5M1m6VWoDXf2FkP3BqV0ZYbO6NA/VFIAAAA
---

`String`（字符串）是 Java 中使用最频繁、也是最重要的类型之一。

## 核心要点总结

- **创建**：用字面量 `String s = "text";` 是首选方式，高效且利用了字符串常量池。
- **比较**：**永远使用 `equals()` 方法比较字符串内容是否相等**，`==` 比较的是内存地址。
- **不可变性**：`String` 对象一旦被创建，其内容就无法更改。所有“修改”操作都会返回一个全新的`String`对象，原始字符串保持不变。
- **常用方法**：花时间去熟悉`length()`, `equals()`, `substring()`, `replace()`, `split()`, `trim()` 等常用方法，它们在日常编程中无处不在。
- **高效拼接**：当需要拼接大量字符串时（尤其是在循环中），为了性能考虑，请使用 `StringBuilder` (非线程安全，但速度快) 或 `StringBuffer` (线程安全)。

## Java 代码

```java
import java.util.Arrays;

/**
 * @author zongliang_i
 */
public class Main {
    public static void main(String[] args) {
        System.out.println("--- 1. 字符串的创建与内存机制 ---");
        demonstrateStringCreation();

        System.out.println("\n--- 2. 字符串的核心特性：不可变性 (Immutability) ---");
        demonstrateImmutability();

        System.out.println("\n--- 3. 字符串常用方法 ---");
        demonstrateCommonMethods();

        System.out.println("\n--- 4. 字符串格式化 (String Formatting) ---");
        demonstrateStringFormatting();

        System.out.println("\n--- 5. 高效的字符串拼接：StringBuilder ---");
        demonstrateStringBuilder();
    }

    /**
     * 1. 演示字符串的两种主要创建方式及其区别
     */
    public static void demonstrateStringCreation() {
        // 方式一：使用字面量 (Literal)
        // JVM会将其放入一个叫做"字符串常量池"的地方。
        // 如果常量池中已存在相同内容的字符串，则直接返回其引用。
        String s1 = "Hello Java";
        String s2 = "Hello Java";

        // 方式二：使用 new 关键字
        // 每次 'new' 都会在堆内存中创建一个全新的String对象，即使内容相同。
        String s3 = new String("Hello Java");

        System.out.println("s1 = \"Hello Java\"");
        System.out.println("s2 = \"Hello Java\"");
        System.out.println("s3 = new String(\"Hello Java\")");

        // "==" 比较的是对象的内存地址
        System.out.println("s1 == s2 ? " + (s1 == s2)); // true, 因为s1和s2指向常量池中的同一个对象
        System.out.println("s1 == s3 ? " + (s1 == s3)); // false, s1在常量池, s3在堆内存，地址不同

        // ".equals()" 方法比较的是字符串的内容
        System.out.println("s1.equals(s3) ? " + s1.equals(s3)); // true, 因为它们的内容相同

        // 结论：比较字符串内容时，请永远使用 .equals() 方法！
    }

    /**
     * 2. 演示字符串的不可变性
     */
    public static void demonstrateImmutability() {
        String originalString = "Java";
        System.out.println("原始字符串: " + originalString);
        System.out.println("原始字符串的哈希码: " + System.identityHashCode(originalString));

        // 任何看似修改字符串的方法，实际上都会返回一个 *新的* 字符串对象
        String modifiedString = originalString.concat(" is great"); // .concat() 用于拼接字符串

        System.out.println("拼接后的字符串: " + modifiedString);
        System.out.println("原始字符串仍然是: " + originalString); // originalString本身并未改变
        System.out.println("新字符串的哈希码: " + System.identityHashCode(modifiedString));
        System.out.println("可以看到，原始字符串和新字符串是两个不同的对象。");
    }

    /**
     * 3. 演示字符串的各种常用方法
     */
    public static void demonstrateCommonMethods() {
        String text = "  Java is a Powerful Programming Language. Java is Fun!  ";

        System.out.println("操作的原始字符串: \"" + text + "\"");
        System.out.println("----------------------------------------------");

        // 获取信息
        System.out.println("长度 (length): " + text.length());
        System.out.println("是否为空 (isEmpty): " + text.isEmpty()); // false
        System.out.println("是否为空白 (isBlank - Java 11+): " + text.isBlank()); // false, 因为有非空白字符
        System.out.println("获取指定索引的字符 (charAt(3)): " + text.charAt(3)); // 'a'

        // 比较
        String compareText = "java is a powerful programming language. java is fun!";
        System.out.println("内容是否相等 (equals): " + text.equals(compareText)); // false
        System.out.println("忽略大小写比较内容 (equalsIgnoreCase): " + text.equalsIgnoreCase(compareText)); // true
        System.out.println("是否以 '  Java' 开头 (startsWith): " + text.startsWith("  Java")); // true
        System.out.println("是否以 'Fun!  ' 结尾 (endsWith): " + text.endsWith("Fun!  ")); // true

        // 查找
        System.out.println("是否包含 'Powerful' (contains): " + text.contains("Powerful")); // true
        System.out.println("子串 'is' 首次出现的位置 (indexOf): " + text.indexOf("is")); // 8
        System.out.println("从索引10开始查找 'is' (indexOf from index 10): " + text.indexOf("is", 10)); // 44
        System.out.println("子串 'Java' 最后出现的位置 (lastIndexOf): " + text.lastIndexOf("Java")); // 40

        // 截取与修改（注意：都会返回新字符串）
        String substring = text.substring(7, 16); // 从索引7开始，到索引16之前结束
        System.out.println("截取子串 (substring(7, 16)): \"" + substring + "\"");

        String upperCase = text.toUpperCase(); // 转为大写
        System.out.println("转为大写 (toUpperCase): \"" + upperCase + "\"");

        String lowerCase = text.toLowerCase(); // 转为小写
        System.out.println("转为小写 (toLowerCase): \"" + lowerCase + "\"");

        String replaced = text.replace("Java", "Python"); // 替换所有出现的"Java"
        System.out.println("替换 (replace 'Java' with 'Python'): \"" + replaced + "\"");

        String trimmed = text.trim(); // 去除首尾的空白字符
        System.out.println("去除首尾空白 (trim): \"" + trimmed + "\"");

        // 分割 
        String data = "apple,banana,orange,grape";
        String[] fruits = data.split(","); // 使用逗号作为分隔符
        System.out.println("按 ',' 分割字符串 (split): " + Arrays.toString(fruits));

        // 转换
        char[] chars = "Test".toCharArray();
        System.out.println("转换为字符数组 (toCharArray): " + Arrays.toString(chars));
    }

    /**
     * 4. 演示字符串格式化
     */
    public static void demonstrateStringFormatting() {
        String name = "Alice";
        int age = 30;
        double salary = 12345.6789;

        // 使用 String.format() 方法
        String formattedString = String.format("User Info: Name is %s, Age is %d, Salary is %.2f", name, age, salary);
        System.out.println(formattedString);
        // %s: 字符串
        // %d: 十进制整数
        // %.2f: 保留两位小数的浮点数

        // System.out.printf()可以直接打印格式化的字符串，效果相同
        System.out.printf("User Info (via printf): Name is %s, Age is %d, Salary is %.2f\n", name, age, salary);
    }

    /**
     * 5. 演示 StringBuilder 用于高效拼接
     */
    public static void demonstrateStringBuilder() {
        // 反例：在循环中使用 '+' 拼接字符串
        // 每次循环都会创建一个新的String对象，非常低效
        String resultFromLoop = "";
        long startTime = System.nanoTime();
        for (int i = 0; i < 1000; i++) {
            resultFromLoop += " " + i;
        }
        long endTime = System.nanoTime();
        System.out.println("使用 '+' 循环拼接1000次耗时: " + (endTime - startTime) + " ns");

        // 正确且高效的方式：使用 StringBuilder
        StringBuilder sb = new StringBuilder();
        startTime = System.nanoTime();
        for (int i = 0; i < 1000; i++) {
            sb.append(" ").append(i); // append方法返回自身，可以链式调用
        }
        String resultFromBuilder = sb.toString(); // 最后转换为String对象
        endTime = System.nanoTime();
        System.out.println("使用 StringBuilder 拼接1000次耗时: " + (endTime - startTime) + " ns");
        System.out.println("结论：在需要大量修改或拼接字符串的场景下，请使用 StringBuilder 或 StringBuffer。");
    }
}
```
