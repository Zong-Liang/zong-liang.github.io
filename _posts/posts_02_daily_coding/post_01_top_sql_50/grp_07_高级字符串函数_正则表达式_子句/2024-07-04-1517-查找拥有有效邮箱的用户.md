---
title: 1517. 查找拥有有效邮箱的用户
date: 2024-07-04 06:00:00 +0800
categories: [Daily Coding, Top SQL 50, 高级字符串函数_正则表达式_子句]
tags: [高级字符串函数_正则表达式_子句]
toc: true
math: true
pin: false
render_with_liquid: false
image:
  path: https://cdn.jsdelivr.net/gh/Zong-Liang/blog_images/blog/2024/daily_coding/20251121171403260.png
  lqip: data:image/webp;base64,UklGRpoAAABXRUJQVlA4WAoAAAAQAAAADwAABwAAQUxQSDIAAAARL0AmbZurmr57yyIiqE8oiG0bejIYEQTgqiDA9vqnsUSI6H+oAERp2HZ65qP/VIAWAFZQOCBCAAAA8AEAnQEqEAAIAAVAfCWkAALp8sF8rgRgAP7o9FDvMCkMde9PK7euH5M1m6VWoDXf2FkP3BqV0ZYbO6NA/VFIAAAA
---

## 题目：1517. 查找拥有有效邮箱的用户

**表结构:** `Users`

| Column Name | Type    |
| ----------- | ------- |
| user_id     | int     |
| name        | varchar |
| mail        | varchar |

`user_id` 是该表的主键。该表包含了网站已注册用户的信息。有一些电子邮件是无效的。

**问题描述:**

编写一个解决方案，以查找具有有效电子邮件的用户。

一个有效的电子邮件具有前缀名称和域，其中：

1. **前缀名称** 是一个字符串，可以包含字母（大小写或小写）、数字、下划线 `_`、点 `.` 和（或）破折号 `-`。前缀名称 **必须** 以字母开头。
2. **域** 为 `'@leetcode.com'`。

可以以任何顺序返回结果表。

**示例 1:**

**输入:**
`Users` 表:

| user_id | name      | mail                    |
| ------- | --------- | ----------------------- |
| 1       | Winston   | winston@leetcode.com    |
| 2       | Jonathan  | jonathanisgreat         |
| 3       | Annabelle | bella-@leetcode.com     |
| 4       | Sally     | sally.come@leetcode.com |
| 5       | Marwan    | quarz#2020@leetcode.com |
| 6       | David     | david69@gmail.com       |
| 7       | Shapiro   | .shapo@leetcode.com     |

**输出:**

| user_id | name      | mail                    |
| ------- | --------- | ----------------------- |
| 1       | Winston   | winston@leetcode.com    |
| 3       | Annabelle | bella-@leetcode.com     |
| 4       | Sally     | sally.come@leetcode.com |

**解释:**

- 用户 2 的电子邮件没有域。
- 用户 5 的电子邮件带有不充许的 '#' 符号。
- 用户 6 的电子邮件没有 leetcode 域。
- 用户 7 的电子邮件以点开头。

## 正确答案 (MySQL)

你可以使用正则表达式 (REGEXP) 来验证电子邮件格式是否符合所有给定条件。

```sql
SELECT 
    user_id, 
    name, 
    mail
FROM Users
WHERE mail REGEXP '^[a-zA-Z][a-zA-Z0-9_.-]*@leetcode\\.com$'
  AND mail LIKE BINARY '%@leetcode.com';

-- OR

SELECT 
    user_id, 
    name, 
    mail
FROM Users
WHERE REGEXP_LIKE(mail, '^[a-zA-Z][a-zA-Z0-9_.-]*@leetcode\\.com$', 'c');
```

**查询逻辑分解:**

- `SELECT user_id, name, mail FROM Users`: 从 `Users` 表中选取所需的列。
- `WHERE mail REGEXP '...'`: 使用正则表达式筛选 `mail` 列。
- `^`: 匹配字符串的开头。
- `[a-zA-Z]`: 确保前缀以一个大写或小写字母开头。
- `[a-zA-Z0-9_.-]*`: 匹配任意数量的字母、数字、下划线、点或破折号。
- `@leetcode\\.com`: 匹配文字字符串 `@leetcode.com`。注意 `.` 需要用 `\\` 转义，因为它在正则表达式中是特殊字符。
- `$`: 匹配字符串的结尾。
