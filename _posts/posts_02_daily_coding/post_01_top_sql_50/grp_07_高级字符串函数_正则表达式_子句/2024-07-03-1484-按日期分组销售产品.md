---
title: 1484. 按日期分组销售产品
date: 2024-07-03 06:00:00 +0800
categories: [Daily Coding, Top SQL 50, 高级字符串函数_正则表达式_子句]
tags: [高级字符串函数_正则表达式_子句]
toc: true
math: true
pin: false
render_with_liquid: false
image:
  path: https://cdn.jsdelivr.net/gh/Zong-Liang/blog_images/blog/2024/daily_coding/20251121172436201.png
  lqip: data:image/webp;base64,UklGRpoAAABXRUJQVlA4WAoAAAAQAAAADwAABwAAQUxQSDIAAAARL0AmbZurmr57yyIiqE8oiG0bejIYEQTgqiDA9vqnsUSI6H+oAERp2HZ65qP/VIAWAFZQOCBCAAAA8AEAnQEqEAAIAAVAfCWkAALp8sF8rgRgAP7o9FDvMCkMde9PK7euH5M1m6VWoDXf2FkP3BqV0ZYbO6NA/VFIAAAA
---

## 题目：1484. 按日期分组销售产品

**表结构:** `Activities`

| 列名      | 类型    |
| --------- | ------- |
| sell_date | date    |
| product   | varchar |

该表没有主键，它可能包含重复项。此表的每一行都包含产品名称和在市场上销售的日期。

**问题描述:**

编写解决方案找出每个日期、销售的不同产品的数量及其名称。

每个日期的销售产品名称应按词典序排列。

返回按 `sell_date` 排序的结果表。

**示例 1:**

**输入:**
`Activities` 表:

| sell_date  | product    |
| ---------- | ---------- |
| 2020-05-30 | Headphone  |
| 2020-06-01 | Pencil     |
| 2020-06-02 | Mask       |
| 2020-05-30 | Basketball |
| 2020-06-01 | Bible      |
| 2020-06-02 | Mask       |
| 2020-05-30 | T-Shirt    |

**输出:**

| sell_date  | num_sold | products                     |
| ---------- | -------- | ---------------------------- |
| 2020-05-30 | 3        | Basketball,Headphone,T-shirt |
| 2020-06-01 | 2        | Bible,Pencil                 |
| 2020-06-02 | 1        | Mask                         |

**解释:**

- 对于 2020-05-30，出售的物品是 (Headphone, Basketball, T-shirt)，按词典序排列，并用逗号 ',' 分隔。
- 对于 2020-06-01，出售的物品是 (Pencil, Bible)，按词典序排列，并用逗号分隔。
- 对于 2020-06-02，出售的物品是 (Mask)，只需返回该物品名。

## 正确答案 (MySQL)

你可以使用 `GROUP BY` 按日期对活动进行分组，并使用 `COUNT(DISTINCT ...)` 和 `GROUP_CONCAT` 函数来获取所需的结果。

```sql
SELECT sell_date,
       COUNT(DISTINCT product)                                           AS num_sold,
       GROUP_CONCAT(DISTINCT product ORDER BY product ASC SEPARATOR ',') AS products
FROM Activities
GROUP BY sell_date
ORDER BY sell_date ASC;
```

**查询逻辑分解:**

- `SELECT sell_date, ...`: 选择销售日期。
- `COUNT(DISTINCT product) AS num_sold`: 计算每个日期销售的 **不同** 产品的数量，并将其别名为 `num_sold`。
- `GROUP_CONCAT(DISTINCT product ORDER BY product ASC SEPARATOR ',') AS products`:
  - `DISTINCT product`: 获取每个分组内不重复的产品名称。
  - `ORDER BY product ASC`: 在连接之前，按字典顺序（升序）对产品名称进行排序。
  - `SEPARATOR ','`: 指定使用逗号作为连接后的分隔符。
  - `GROUP_CONCAT(...)`: 将排序后的不同产品名称连接成一个字符串。
  - `AS products`: 将结果字符串别名为 `products`。
- `FROM Activities`: 从 `Activities` 表中查询数据。
- `GROUP BY sell_date`: 按 `sell_date` 对行进行分组，以便聚合函数（`COUNT` 和 `GROUP_CONCAT`）可以对每个日期的数据进行操作。
- `ORDER BY sell_date ASC`: 按销售日期对最终结果集进行升序排序。
