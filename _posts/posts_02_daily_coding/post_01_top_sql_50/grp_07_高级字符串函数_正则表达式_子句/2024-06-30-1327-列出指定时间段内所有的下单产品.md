---
title: 1327. 列出指定时间段内所有的下单产品
date: 2024-06-30 06:00:00 +0800
categories: [Daily Coding, Top SQL 50, 高级字符串函数_正则表达式_子句]
tags: [高级字符串函数_正则表达式_子句]
toc: true
math: true
pin: false
render_with_liquid: false
image:
  path: https://cdn.jsdelivr.net/gh/Zong-Liang/blog_images/blog/2024/daily_coding/20251121171121536.png
  lqip: data:image/webp;base64,UklGRpoAAABXRUJQVlA4WAoAAAAQAAAADwAABwAAQUxQSDIAAAARL0AmbZurmr57yyIiqE8oiG0bejIYEQTgqiDA9vqnsUSI6H+oAERp2HZ65qP/VIAWAFZQOCBCAAAA8AEAnQEqEAAIAAVAfCWkAALp8sF8rgRgAP7o9FDvMCkMde9PK7euH5M1m6VWoDXf2FkP3BqV0ZYbO6NA/VFIAAAA
---

## 题目：1327. 列出指定时间段内所有的下单产品

**表结构:**

`Products`

| Column Name      | Type    |
| ---------------- | ------- |
| product_id       | int     |
| product_name     | varchar |
| product_category | varchar |

`product_id` 是该表主键。该表包含该公司产品的数据。

`Orders`

| Column Name | Type |
| ----------- | ---- |
| product_id  | int  |
| order_date  | date |
| unit        | int  |

该表可能包含重复行。`product_id` 是表 `Products` 的外键。`unit` 是在日期 `order_date` 内下单产品的数目。

**问题描述:**

写一个解决方案，要求获取在 2020 年 2 月份下单的数量不少于 100 的产品的名字和数目。

返回结果表的顺序无要求。

**示例 1:**

**输入:**
`Products` 表:

| product_id | product_name          | product_category |
| ---------- | --------------------- | ---------------- |
| 1          | Leetcode Solutions    | Book             |
| 2          | Jewels of Stringology | Book             |
| 3          | HP                    | Laptop           |
| 4          | Lenovo                | Laptop           |
| 5          | Leetcode Kit          | T-shirt          |

`Orders` 表:

| product_id | order_date | unit |
| ---------- | ---------- | ---- |
| 1          | 2020-02-05 | 60   |
| 1          | 2020-02-10 | 70   |
| 2          | 2020-01-18 | 30   |
| 2          | 2020-02-11 | 80   |
| 3          | 2020-02-17 | 2    |
| 3          | 2020-02-24 | 3    |
| 4          | 2020-03-01 | 20   |
| 4          | 2020-03-04 | 30   |
| 5          | 2020-02-25 | 50   |
| 5          | 2020-02-27 | 50   |
| 5          | 2020-03-01 | 50   |

**输出:**

| product_name       | unit |
| ------------------ | ---- |
| Leetcode Solutions | 130  |
| Leetcode Kit       | 100  |

**解释:**

- 2020 年 2 月份下单 `product_id = 1` 的产品数目总和为 (60 + 70) = 130。
- 2020 年 2 月份下单 `product_id = 2` 的产品数目总和为 80。
- 2020 年 2 月份下单 `product_id = 3` 的产品数目总和为 (2 + 3) = 5。
- 2020 年 2 月份 `product_id = 4` 的产品并没有下单。
- 2020 年 2 月份下单 `product_id = 5` 的产品数目总和为 (50 + 50) = 100。

## 正确答案 (MySQL)

你可以通过连接两个表，按产品分组并计算总 `unit`，然后筛选出符合条件的记录。

```sql
SELECT p.product_name,
       SUM(o.unit) AS unit
FROM Products p
         JOIN
     Orders o ON p.product_id = o.product_id
WHERE o.order_date BETWEEN '2020-02-01' AND '2020-02-29'
GROUP BY p.product_id, p.product_name
HAVING SUM(o.unit) >= 100;
```

**查询逻辑分解:**

- `SELECT p.product_name, SUM(o.unit) AS unit`: 选择产品名称，并计算每个产品在指定时间范围内的总销售单元数，将其命名为
  `unit`。
- `FROM Products p JOIN Orders o ON p.product_id = o.product_id`: 将 `Products` 表和 `Orders` 表通过 `product_id`
  连接起来，以便获取产品名称。
- `WHERE o.order_date BETWEEN '2020-02-01' AND '2020-02-29'`: 筛选出订单日期在 2020 年 2 月份的所有订单。也可以使用
  `WHERE DATE_FORMAT(o.order_date, '%Y-%m') = '2020-02'`。
- `GROUP BY p.product_id, p.product_name`: 按产品进行分组，以便 `SUM()` 函数能计算每个产品的总和。
- `HAVING SUM(o.unit) >= 100`: 在分组后进行筛选，只保留总销售单元数大于或等于 100 的产品。
