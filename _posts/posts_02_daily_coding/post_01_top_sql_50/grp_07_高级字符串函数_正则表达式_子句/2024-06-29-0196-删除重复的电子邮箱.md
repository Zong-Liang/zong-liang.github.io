---
title: 0196. 删除重复的电子邮箱
date: 2024-06-29 06:00:00 +0800
categories: [Daily Coding, Top SQL 50, 高级字符串函数_正则表达式_子句]
tags: [高级字符串函数_正则表达式_子句]
toc: true
math: true
pin: false
render_with_liquid: false
image:
  path: https://cdn.jsdelivr.net/gh/Zong-Liang/blog_images/blog/2024/daily_coding/20251121171032719.png
  lqip: data:image/webp;base64,UklGRpoAAABXRUJQVlA4WAoAAAAQAAAADwAABwAAQUxQSDIAAAARL0AmbZurmr57yyIiqE8oiG0bejIYEQTgqiDA9vqnsUSI6H+oAERp2HZ65qP/VIAWAFZQOCBCAAAA8AEAnQEqEAAIAAVAfCWkAALp8sF8rgRgAP7o9FDvMCkMde9PK7euH5M1m6VWoDXf2FkP3BqV0ZYbO6NA/VFIAAAA
---

## 题目：0196. 删除重复的电子邮箱

**表结构:** `Person`

| Column Name | Type    |
| ----------- | ------- |
| id          | int     |
| email       | varchar |

`id` 是该表的主键列。该表的每一行包含一封电子邮件。电子邮件将不包含大写字母。

**问题描述:**

编写解决方案 **删除** 所有重复的电子邮件，只保留一个具有最小 `id` 的唯一电子邮件。

(对于 SQL 用户，请注意你应该编写一个 `DELETE` 语句而不是 `SELECT` 语句。)

运行脚本后，显示的答案是 `Person` 表。驱动程序将首先编译并运行您的代码片段，然后再显示 `Person` 表。`Person` 表的最终顺序无关紧要。

**示例 1:**

**输入:**
`Person` 表:

| id  | email            |
| --- | ---------------- |
| 1   | john@example.com |
| 2   | bob@example.com  |
| 3   | john@example.com |

**输出:**

| id  | email            |
| --- | ---------------- |
| 1   | john@example.com |
| 2   | bob@example.com  |

**解释:** john@example.com 重复两次。我们保留最小的 Id = 1。

## 正确答案 (MySQL)

您可以使用自连接 (self-join) 来识别并删除那些 email 重复且 `id` 不是最小的行。

```sql
DELETE
p1
FROM
    Person p1,
    Person p2
WHERE
    p1.email = p2.email AND p1.id > p2.id;
```

**查询逻辑分解:**

- `DELETE p1 FROM Person p1, Person p2`: 这条语句表示我们要从 `Person` 表（我们将其别名为 `p1`）中删除行。它通过将 `Person`
  表与自身进行比较（第二个实例别名为 `p2`）来决定要删除哪些行。
- `WHERE p1.email = p2.email`: 这是连接条件。它会找出所有 email 地址相同的行对。
- `AND p1.id > p2.id`: 这是关键的筛选条件。对于任何一组具有相同 email 的记录，这个条件会标识出 `id` 不是最小的那些记录。例如，对于
  `john@example.com`，我们有 (id=1) 和 (id=3)。
  - 当 `p1.id=3` 且 `p2.id=1` 时，条件 `p1.id > p2.id` 成立，因此 `id=3` 的行被标记为删除。
  - `id=1` 的行永远不会被删除，因为不存在 `id` 比它更小的具有相同 email 的行。
- 最终，只有那些 email 重复且 `id` 更大的行会被删除，从而保留了每个 email 对应的 `id` 最小的行。
