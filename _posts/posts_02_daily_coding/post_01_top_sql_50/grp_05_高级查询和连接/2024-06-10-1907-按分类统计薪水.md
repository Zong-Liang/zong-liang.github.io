---
title: 1907. 按分类统计薪水
date: 2024-06-10 06:00:00 +0800
categories: [Daily Coding, Top SQL 50, 高级查询和连接]
tags: [高级查询和连接]
toc: true
math: true
pin: false
render_with_liquid: false
image:
  path: https://cdn.jsdelivr.net/gh/Zong-Liang/blog_images/blog/2024/daily_coding/20251121165648713.png
  lqip: data:image/webp;base64,UklGRpoAAABXRUJQVlA4WAoAAAAQAAAADwAABwAAQUxQSDIAAAARL0AmbZurmr57yyIiqE8oiG0bejIYEQTgqiDA9vqnsUSI6H+oAERp2HZ65qP/VIAWAFZQOCBCAAAA8AEAnQEqEAAIAAVAfCWkAALp8sF8rgRgAP7o9FDvMCkMde9PK7euH5M1m6VWoDXf2FkP3BqV0ZYbO6NA/VFIAAAA
---

## 题目：1907. 按分类统计薪水

**表:** `Accounts`

| 列名       | 类型 |
| ---------- | ---- |
| account_id | int  |
| income     | int  |

- 在 SQL 中, `account_id` 是这个表的主键。
- 每一行都包含一个银行帐户的月收入的信息。

**问题描述:**

查询每个工资类别的银行账户数量。工资类别如下：

- **"Low Salary"**: 所有工资 **严格低于** 20000 美元。
- **"Average Salary"**: **包含** 范围内的所有工资 `[$20000, $50000]`。
- **"High Salary"**: 所有工资 **严格大于** 50000 美元。

结果表 **必须** 包含所有三个类别。如果某个类别中没有帐户，则报告 0。

按 **任意顺序** 返回结果表。

**示例 1:**

**输入:**
`Accounts` 表:

| account_id | income |
| ---------- | ------ |
| 3          | 108939 |
| 2          | 12747  |
| 8          | 87709  |
| 6          | 91796  |

**输出:**

| category       | accounts_count |
| -------------- | -------------- |
| Low Salary     | 1              |
| Average Salary | 0              |
| High Salary    | 3              |

**解释:**

- 低薪：有一个账户 2。
- 中等薪水：没有。
- 高薪：有三个账户，他们是 3, 6 和 8。

## 正确答案 (MySQL)

由于结果中必须包含所有三个类别（即使计数为 0），一个直接的方法是分别为每个类别编写一个查询，然后使用 `UNION ALL` 将它们的结果合并起来。

```sql
SELECT 'Low Salary'      AS category,
       COUNT(account_id) AS accounts_count
FROM Accounts
WHERE income < 20000

UNION ALL

SELECT 'Average Salary'  AS category,
       COUNT(account_id) AS accounts_count
FROM Accounts
WHERE income BETWEEN 20000 AND 50000

UNION ALL

SELECT 'High Salary'     AS category,
       COUNT(account_id) AS accounts_count
FROM Accounts
WHERE income > 50000;
```

**查询逻辑分解:**

这个查询由三个独立的 `SELECT` 语句构成，它们的结果通过 `UNION ALL` 合并成一个最终的结果集。

1. **第一个 `SELECT` (Low Salary):**

   - `SELECT 'Low Salary' AS category, ...`: 创建一个名为 `category` 的列，其值为 'Low Salary'。
   - `COUNT(account_id) AS accounts_count`: 计算满足条件的账户数量。
   - `WHERE income < 20000`: 筛选出所有收入严格小于 20000 的账户。

2. **第二个 `SELECT` (Average Salary):**

   - `SELECT 'Average Salary' AS category, ...`: 创建 `category` 列，值为 'Average Salary'。
   - `WHERE income BETWEEN 20000 AND 50000`: 筛选出所有收入在 20000 和 50000 之间（包含边界值）的账户。

3. **第三个 `SELECT` (High Salary):**

   - `SELECT 'High Salary' AS category, ...`: 创建 `category` 列，值为 'High Salary'。
   - `WHERE income > 50000`: 筛选出所有收入严格大于 50000 的账户。

4. **`UNION ALL`**:
   - 这个操作符将上述三个查询的结果垂直地合并在一起。即使某个查询的结果是 0，它也会生成一行（例如：'Average Salary',
     0），从而确保最终输出包含了所有三个类别，满足了题目的要求。
