---
title: 180. 连续出现的数字
date: 2024-05-31 06:00:00 +0800
categories: [Daily Coding, Top SQL 50, 高级查询和连接]
tags: [高级查询和连接]
toc: true
math: true
pin: false
render_with_liquid: false
image:
  path: https://cdn.jsdelivr.net/gh/Zong-Liang/blog_images/blog/2024/daily_coding/20251121165151025.png
  lqip: data:image/webp;base64,UklGRpoAAABXRUJQVlA4WAoAAAAQAAAADwAABwAAQUxQSDIAAAARL0AmbZurmr57yyIiqE8oiG0bejIYEQTgqiDA9vqnsUSI6H+oAERp2HZ65qP/VIAWAFZQOCBCAAAA8AEAnQEqEAAIAAVAfCWkAALp8sF8rgRgAP7o9FDvMCkMde9PK7euH5M1m6VWoDXf2FkP3BqV0ZYbO6NA/VFIAAAA
---

## 题目：180. 连续出现的数字

**表:** `Logs`

| Column Name | Type    |
| ----------- | ------- |
| id          | int     |
| num         | varchar |

- 在 SQL 中, `id` 是该表的主键。
- `id` 是一个自增列。

**问题描述:**

找出所有至少连续出现三次的数字。

返回的结果表中的数据可以按 **任意顺序** 排列。

**示例 1:**

**输入:**
`Logs` 表:

| id  | num |
| --- | --- |
| 1   | 1   |
| 2   | 1   |
| 3   | 1   |
| 4   | 2   |
| 5   | 1   |
| 6   | 2   |
| 7   | 2   |

**输出:**
`Result` 表:

| ConsecutiveNums |
| --------------- |
| 1               |

**解释:** 1 是唯一连续出现至少三次的数字。

## 题解

你可以通过将 `Logs` 表与自身进行两次自连接（self-join）来解决这个问题，以检查连续的行。

```sql
SELECT DISTINCT l1.num AS ConsecutiveNums
FROM Logs l1,
     Logs l2,
     Logs l3
WHERE l1.id = l2.id - 1
  AND l2.id = l3.id - 1
  AND l1.num = l2.num
  AND l2.num = l3.num;
```

**查询逻辑分解:**

1. **`FROM Logs l1, Logs l2, Logs l3`**:

   - 我们将 `Logs` 表视为三个独立的副本，并分别给它们别名 `l1`, `l2`, 和 `l3`。

2. **`WHERE l1.id = l2.id - 1 AND l2.id = l3.id - 1`**:

   - 这是用来匹配连续行的关键条件。它确保了 `l1`, `l2`, `l3` 所代表的行是 `id` 连续的三行（例如，id 分别为 1, 2, 3）。

3. **`AND l1.num = l2.num AND l2.num = l3.num`**:

   - 这个条件进一步筛选，要求这连续三行的 `num` 字段的值必须完全相同。

4. **`SELECT DISTINCT l1.num AS ConsecutiveNums`**:
   - `SELECT l1.num`: 从满足上述所有条件的行组中，选出 `num` 的值。
   - `DISTINCT`: 使用 `DISTINCT` 关键字来去重。因为一个数字可能连续出现超过三次（例如四次或五次），如果不去重，它可能会在结果中出现多次。
   - `AS ConsecutiveNums`: 将结果列重命名为 `ConsecutiveNums` 以匹配输出格式。
