---
title: 197. 上升的温度
date: 2024-04-12 06:00:00 +0800
categories: [Daily Coding, Top SQL 50, 连接]
tags: [连接]
toc: true
math: true
pin: false
render_with_liquid: false
image:
  path: https://cdn.jsdelivr.net/gh/Zong-Liang/blog_images/blog/2024/daily_coding/20251121161439919.png
  lqip: data:image/webp;base64,UklGRpoAAABXRUJQVlA4WAoAAAAQAAAADwAABwAAQUxQSDIAAAARL0AmbZurmr57yyIiqE8oiG0bejIYEQTgqiDA9vqnsUSI6H+oAERp2HZ65qP/VIAWAFZQOCBCAAAA8AEAnQEqEAAIAAVAfCWkAALp8sF8rgRgAP7o9FDvMCkMde9PK7euH5M1m6VWoDXf2FkP3BqV0ZYbO6NA/VFIAAAA
---

## 题目：197. 上升的温度

**表:** `Weather`

| Column Name | Type |
| ----------- | ---- |
| id          | int  |
| recordDate  | date |
| temperature | int  |

- `id` 是该表具有唯一值的列。
- 没有具有相同 `recordDate` 的不同行。
- 该表包含特定日期的温度信息。

**问题描述:**

编写解决方案，找出与之前（昨天）日期相比温度更高的所有日期的 `id`。

返回结果 **无顺序要求**。

**示例 1:**

**输入:**

`Weather` 表:

| id  | recordDate | Temperature |
| --- | ---------- | ----------- |
| 1   | 2015-01-01 | 10          |
| 2   | 2015-01-02 | 25          |
| 3   | 2015-01-03 | 20          |
| 4   | 2015-01-04 | 30          |

**输出:**

| id  |
| --- |
| 2   |
| 4   |

**解释:**

- 2015-01-02 的温度比前一天高 (10 -> 25)
- 2015-01-04 的温度比前一天高 (20 -> 30)

## 正确答案 (MySQL)

你可以使用自连接（self-join）将 `Weather` 表与自身进行比较，以匹配相邻的两天。

```sql
SELECT w1.id
FROM Weather w1
JOIN Weather w2
  ON DATEDIFF(w1.recordDate, w2.recordDate) = 1
WHERE w1.temperature > w2.temperature;

-- OR

SELECT w1.id
FROM Weather w1,
     Weather w2
WHERE DATEDIFF(w1.recordDate, w2.recordDate) = 1
  AND w1.temperature > w2.temperature;
```

**查询逻辑分解:**

1. **`FROM Weather w1, Weather w2`**:

   - 这是一个隐式的自连接。我们将 `Weather` 表视为两个独立的副本，并分别给它们别名 `w1` 和 `w2`。`w1` 将代表“今天”，`w2`
     将代表“昨天”。

2. **`WHERE DATEDIFF(w1.recordDate, w2.recordDate) = 1`**:

   - `DATEDIFF()` 函数计算两个日期之间的天数差。
   - 这个条件会找出所有 `w1` 的日期恰好比 `w2` 的日期晚一天的行对。这样，每一对匹配的行就分别代表了连续的两天。

3. **`AND w1.temperature > w2.temperature`**:

   - 这个条件进一步筛选，要求“今天”（`w1`）的温度必须严格大于“昨天”（`w2`）的温度。

4. **`SELECT w1.id`**:

   - 从满足上述所有条件的行对中，我们选出“今天”的 `id`，即 `w1.id`。
