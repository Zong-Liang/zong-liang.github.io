---
title: 0626. 换座位
date: 2024-06-19 06:00:00 +0800
categories: [Daily Coding, Top SQL 50, 子查询]
tags: [子查询]
toc: true
math: true
pin: false
render_with_liquid: false
image:
  path: https://cdn.jsdelivr.net/gh/Zong-Liang/blog_images/blog/2024/daily_coding/20251121170305110.png
  lqip: data:image/webp;base64,UklGRpoAAABXRUJQVlA4WAoAAAAQAAAADwAABwAAQUxQSDIAAAARL0AmbZurmr57yyIiqE8oiG0bejIYEQTgqiDA9vqnsUSI6H+oAERp2HZ65qP/VIAWAFZQOCBCAAAA8AEAnQEqEAAIAAVAfCWkAALp8sF8rgRgAP7o9FDvMCkMde9PK7euH5M1m6VWoDXf2FkP3BqV0ZYbO6NA/VFIAAAA
---

## 题目：0626. 换座位

**表:** `Seat`

| Column Name | Type    |
| ----------- | ------- |
| id          | int     |
| student     | varchar |

- `id` 是该表的主键（唯一值）列。
- 该表的每一行都表示学生的姓名和 ID。
- ID 序列始终从 1 开始并连续增加。

**问题描述:**

编写解决方案来交换每两个连续的学生的座位号。如果学生的数量是奇数，则最后一个学生的 id 不交换。

按 `id` **升序** 返回结果表。


**示例 1:**

**输入:**
`Seat` 表:

| id  | student |
| --- | ------- |
| 1   | Abbot   |
| 2   | Doris   |
| 3   | Emerson |
| 4   | Green   |
| 5   | Jeames  |

**输出:**

| id  | student |
| --- | ------- |
| 1   | Doris   |
| 2   | Abbot   |
| 3   | Green   |
| 4   | Emerson |
| 5   | Jeames  |

**解释:**
请注意，如果学生人数为奇数，则不需要更换最后一名学生的座位。


## 正确答案 (MySQL)

您可以使用 `CASE` 语句来处理交换座位的逻辑，并结合窗口函数 `COUNT(*) OVER()` 来判断是否为最后一个座位。

```sql
SELECT CASE
           -- 如果 id 是奇数且不是最后一个座位，则 id + 1
           WHEN MOD(s.id, 2) != 0 AND s.id != (SELECT COUNT(*) FROM Seat) THEN s.id + 1
        -- 如果 id 是偶数，则 id - 1
        WHEN MOD(s.id, 2) = 0 THEN s.id - 1
        -- 如果 id 是奇数且是最后一个座位，则 id 不变
        ELSE s.id
END
AS id,
    s.student
FROM
    Seat s
ORDER BY
    id ASC;
```

**另一种使用窗口函数的更优解法：**

```

sql
SELECT CASE
WHEN MOD(id, 2) != 0 AND id != COUNT(*) OVER() THEN id + 1
WHEN MOD(id, 2) = 0 THEN id - 1
ELSE id
END
AS id,
student
FROM
Seat
ORDER BY
id ASC;

```

**查询逻辑分解:**

这个查询的核心是为每一行生成一个新的 `id`，然后按这个新 `id` 排序。

1. **`CASE ... END AS id`**: `CASE` 语句用于根据条件为每个学生分配一个新的座位 `id`。
   - **`WHEN MOD(id, 2) != 0 AND id != COUNT(*) OVER()`**:
     - `MOD(id, 2) != 0`: 检查当前学生的 `id` 是否为奇数。
     - `COUNT(*) OVER()`: 这是一个窗口函数，它计算表中的总行数。
     - `id != COUNT(*) OVER()`: 检查当前行是否为最后一行。
     - 如果两个条件都满足（`id` 是奇数且不是最后一个），则新座位 `id` 为 `id + 1`。
   - **`WHEN MOD(id, 2) = 0`**: 如果当前学生的 `id` 是偶数，则新座位 `id` 为 `id - 1`。
   - **`ELSE id`**: 这个条件适用于不满足以上任何条件的情况，即 `id` 是奇数并且是最后一行。在这种情况下，座位 `id` 保持不变。
2. **`FROM Seat`**: 从 `Seat` 表中查询数据。
3. **`ORDER BY id ASC`**: 最后，根据我们用 `CASE` 语句生成的新 `id` 对结果进行升序排序，以获得正确的最终顺序。
