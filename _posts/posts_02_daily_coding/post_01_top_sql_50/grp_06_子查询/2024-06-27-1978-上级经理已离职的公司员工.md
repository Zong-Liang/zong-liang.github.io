---
title: 1978. 上级经理已离职的公司员工
date: 2024-06-27 06:00:00 +0800
categories: [Daily Coding, Top SQL 50, 子查询]
tags: [子查询]
toc: true
math: true
pin: false
render_with_liquid: false
image:
  path: https://cdn.jsdelivr.net/gh/Zong-Liang/blog_images/blog/2024/daily_coding/20251121170559810.png
  lqip: data:image/webp;base64,UklGRpoAAABXRUJQVlA4WAoAAAAQAAAADwAABwAAQUxQSDIAAAARL0AmbZurmr57yyIiqE8oiG0bejIYEQTgqiDA9vqnsUSI6H+oAERp2HZ65qP/VIAWAFZQOCBCAAAA8AEAnQEqEAAIAAVAfCWkAALp8sF8rgRgAP7o9FDvMCkMde9PK7euH5M1m6VWoDXf2FkP3BqV0ZYbO6NA/VFIAAAA
---

## 题目：1978. 上级经理已离职的公司员工

**表:** `Employees`

| Column Name | Type    |
| ----------- | ------- |
| employee_id | int     |
| name        | varchar |
| manager_id  | int     |
| salary      | int     |

- 在 SQL 中, `employee_id` 是这个表的主键。
- 这个表包含了员工，他们的薪水和上级经理的 id。
- 有一些员工没有上级经理（其 `manager_id` 是空值）。

**问题描述:**

查找这些员工的 id，他们的薪水严格少于 $30000 并且他们的上级经理已离职。当一个经理离开公司时，他们的信息需要从员工表中删除掉，但是表中的员工的
`manager_id` 这一列还是设置的离职经理的 id。

返回的结果按照 `employee_id` 从小到大排序。


**示例:**

**输入:**
`Employees` table:

| employee_id | name      | manager_id | salary |
| ----------- | --------- | ---------- | ------ |
| 3           | Mila      | 9          | 60301  |
| 12          | Antonella | null       | 31000  |
| 13          | Emery     | null       | 67084  |
| 1           | Kalel     | 11         | 21241  |
| 9           | Mikaela   | null       | 50937  |
| 11          | Joziah    | 6          | 28485  |

**输出:**

| employee_id |
| ----------- |
| 11          |

**解释:**

- 薪水少于 30000 美元的员工有 1 号(Kalel) 和 11 号(Joziah)。
- Kalel 的上级经理是 11 号员工，他还在公司上班(他是 Joziah )。
- Joziah 的上级经理是 6 号员工，他已经离职，因为员工表里面已经没有 6 号员工的信息了，它被删除了。


## 正确答案 (MySQL)

你可以使用一个子查询来找出所有当前在职的员工 ID，然后在主查询中筛选出那些经理 ID 不在这个列表中的员工。

```sql
SELECT employee_id
FROM Employees
WHERE salary < 30000
  AND manager_id IS NOT NULL
  AND manager_id NOT IN (SELECT employee_id
                         FROM Employees)
ORDER BY employee_id ASC;

```

**查询逻辑分解:**

1. **`SELECT employee_id FROM Employees`**: 从 `Employees` 表中选择 `employee_id`。
2. **`WHERE salary < 30000`**: 第一个筛选条件，确保员工的薪水严格小于 30000。
3. **`AND manager_id IS NOT NULL`**: 第二个筛选条件，确保员工有一个经理。如果 `manager_id` 为空，那么他们就没有经理，也就谈不上经理离职。
4. **`AND manager_id NOT IN (SELECT employee_id FROM Employees)`**: 这是核心条件。
   - 子查询 `(SELECT employee_id FROM Employees)` 会返回一个包含所有当前在职员工 `employee_id` 的列表。
   - `manager_id NOT IN (...)` 会检查当前员工的 `manager_id` 是否 **不** 在这个在职员工列表中。如果不在，就意味着该经理已经离职。
5. **`ORDER BY employee_id ASC`**: 按照 `employee_id` 对最终结果进行升序排序。
