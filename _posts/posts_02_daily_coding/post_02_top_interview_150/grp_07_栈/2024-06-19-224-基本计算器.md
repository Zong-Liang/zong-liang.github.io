---
title: 224. 基本计算器
date: 2024-06-19 06:00:00 +0800
categories: [Daily Coding, Top Interview 150, 栈]
tags: [栈]
toc: true
math: true
pin: false
render_with_liquid: false
image:
  path: https://cdn.jsdelivr.net/gh/Zong-Liang/blog_images/blog/2024/daily_coding/20251121230246168.png
  lqip: data:image/webp;base64,UklGRpoAAABXRUJQVlA4WAoAAAAQAAAADwAABwAAQUxQSDIAAAARL0AmbZurmr57yyIiqE8oiG0bejIYEQTgqiDA9vqnsUSI6H+oAERp2HZ65qP/VIAWAFZQOCBCAAAA8AEAnQEqEAAIAAVAfCWkAALp8sF8rgRgAP7o9FDvMCkMde9PK7euH5M1m6VWoDXf2FkP3BqV0ZYbO6NA/VFIAAAA
---

## 题目：224. 基本计算器

**描述**

给你一个字符串表达式 `s` ，请你实现一个基本计算器来计算并返回它的值。

注意: 不允许使用任何将字符串作为数学表达式计算的内置函数，比如 `eval()` 。

**示例 1:**

- **输入:** `s = "1 + 1"`
- **输出:** 2

**示例 2:**

- **输入:** `s = " 2-1 + 2 "`
- **输出:** 3

**示例 3:**

- **输入:** `s = "(1+(4+5+2)-3)+(6+8)"`
- **输出:** 23

**提示:**

- `1 <= s.length <= 3 * 10^5`
- `s` 由数字、`'+'`、`'-'`、`'('`、`')'`、和 `' '` 组成
- `s` 表示一个有效的表达式
- `'+'` 不能用作一元运算 (例如， `"+1"` 和 `"+(2 + 3)"` 无效)
- `'-'` 可以用作一元运算 (即 `"-1"` 和 `"-(2 + 3)"` 是有效的)
- 输入中不存在两个连续的操作符
- 每个数字和运行的计算将适合于一个有符号的 32 位整数

## 题解

```java
import java.util.Stack;

public class Main {

    /**
     * 实现一个基本计算器来计算字符串表达式的值
     *
     * @param s 字符串表达式
     * @return 表达式的计算结果
     */
    public static int calculate(String s) {
        // 使用栈来处理括号
        Stack<Integer> stack = new Stack<>();

        // result 用于存储当前括号内的计算结果
        int result = 0;
        // sign 代表当前数字或括号前的符号，1 表示 '+', -1 表示 '-'
        int sign = 1;

        for (int i = 0; i < s.length(); i++) {
            char c = s.charAt(i);

            if (Character.isDigit(c)) {
                // 处理多位数字
                int num = 0;
                while (i < s.length() && Character.isDigit(s.charAt(i))) {
                    num = num * 10 + (s.charAt(i) - '0');
                    i++;
                }
                // while 循环结束后，i 指向数字的下一个字符，需要回退一位
                // 以便 for 循环的 i++ 能够正确处理
                i--;
                result += sign * num;
            } else if (c == '+') {
                sign = 1;
            } else if (c == '-') {
                sign = -1;
            } else if (c == '(') {
                // 遇到左括号，将当前的结果和符号入栈
                stack.push(result);
                stack.push(sign);
                // 重置 result 和 sign，准备计算括号内的表达式
                result = 0;
                sign = 1;
            } else if (c == ')') {
                // 遇到右括号，计算结束
                // 栈顶弹出的是括号前的符号
                int prevSign = stack.pop();
                // 再次弹出的是括号外的累计结果
                int prevResult = stack.pop();
                // 计算最终结果：括号外的结果 + 括号前的符号 * 括号内的结果
                result = prevResult + prevSign * result;
            }
            // 忽略空格
        }

        return result;
    }

    public static void main(String[] args) {
        // 示例 1
        String s1 = "1 + 1";
        System.out.println(calculate(s1)); // 预期输出: 2

        // 示例 2
        String s2 = " 2-1 + 2 ";
        System.out.println(calculate(s2)); // 预期输出: 3

        // 示例 3
        String s3 = "(1+(4+5+2)-3)+(6+8)";
        System.out.println(calculate(s3)); // 预期输出: 23

        // 其他测试用例
        String s4 = "-(2 + 3)";
        System.out.println(calculate(s4)); // 预期输出: -5
    }
}
```
