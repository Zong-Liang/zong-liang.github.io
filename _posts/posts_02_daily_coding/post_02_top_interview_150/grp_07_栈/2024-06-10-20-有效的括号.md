---
title: 20. 有效的括号
date: 2024-06-10 06:00:00 +0800
categories: [Daily Coding, Top Interview 150, 栈]
tags: [栈]
toc: true
math: true
pin: false
render_with_liquid: false
image:
  path: https://cdn.jsdelivr.net/gh/Zong-Liang/blog_images/blog/2024/daily_coding/20251121225821828.png
  lqip: data:image/webp;base64,UklGRpoAAABXRUJQVlA4WAoAAAAQAAAADwAABwAAQUxQSDIAAAARL0AmbZurmr57yyIiqE8oiG0bejIYEQTgqiDA9vqnsUSI6H+oAERp2HZ65qP/VIAWAFZQOCBCAAAA8AEAnQEqEAAIAAVAfCWkAALp8sF8rgRgAP7o9FDvMCkMde9PK7euH5M1m6VWoDXf2FkP3BqV0ZYbO6NA/VFIAAAA
---

## 题目：20. 有效的括号

**描述：**

给定一个只包括 `'('`，`')'`，`'{'`，`'}'`，`'['`，`']'` 的字符串 `s` ，判断字符串是否有效。

有效字符串需满足：

1.  左括号必须用相同类型的右括号闭合。
2.  左括号必须以正确的顺序闭合。
3.  每个右括号都有一个对应的相同类型的左括号。

**示例 1:**

- **输入:** `s = "()"`
- **输出:** `true`

**示例 2:**

- **输入:** `s = "()[]{}"`
- **输出:** `true`

**示例 3:**

- **输入:** `s = "(]"`
- **输出:** `false`

**示例 4:**

- **输入:** `s = "([)]"`
- **输出:** `false`

**示例 5:**

- **输入:** `s = "{[]}"`
- **输出:** `true`

**提示:**

- `1 <= s.length <= 10^4`
- `s` 仅由括号 `'()[]{}'` 组成

## 题解

### 解法：辅助栈（Stack）

**思路：**

括号匹配是典型的“后进先出”（LIFO）场景，最后遇到的左括号，应该是最先被闭合的。因此，**栈（Stack）** 是解决此类问题的最佳数据结构。

1.  **奇数剪枝**：如果字符串长度是奇数，无法两两配对，直接返回 `false`。
2.  **遍历字符串**：

    - 遇到 **左括号** `(`, `[`, `{` 时，将对应的 **右括号** `)`, `]`, `}` 推入栈中。（这样做的好处是，后续遇到右括号时，只需比较当前字符与栈顶字符是否相等即可，无需映射表）。
    - 遇到 **右括号** 时：

      - 如果栈为空，说明没有对应的左括号，无效，返回 `false`。
      - 弹出栈顶元素。如果栈顶元素（即预期的右括号）与当前遍历到的字符不相等，说明括号类型不匹配，返回 `false`。

3.  **结果判断**：

    - 遍历结束后，如果栈为空，说明所有左括号都已正确闭合，返回 `true`。
    - 如果栈不为空，说明还有未闭合的左括号，返回 `false`。

**复杂度分析：**

- **时间复杂度：** $O(n)$，其中 $n$ 是字符串的长度。我们需要遍历整个字符串一次。
- **空间复杂度：** $O(n)$。在最坏情况下（例如 `(((((`），栈中需要存储 $n$ 个字符。

**代码片段：**

```java
public boolean isValid(String s) {
    // 如果长度为奇数，肯定无法完全匹配
    if (s.length() % 2 != 0) return false;

    // 使用 Deque 接口作为栈使用，性能优于 Stack 类
    Deque<Character> stack = new ArrayDeque<>();

    for (char c : s.toCharArray()) {
        if (c == '(') {
            stack.push(')');
        } else if (c == '[') {
            stack.push(']');
        } else if (c == '{') {
            stack.push('}');
        } else {
            // 此时 c 是右括号
            // 如果栈为空（没有左括号）或者栈顶元素不等于当前右括号
            if (stack.isEmpty() || stack.pop() != c) {
                return false;
            }
        }
    }
    // 只有栈为空才算完全匹配
    return stack.isEmpty();
}
```

### 完整代码

```java
import java.util.ArrayDeque;
import java.util.Deque;

public class Main {

    // 核心算法实现
    public static boolean isValid(String s) {
        // 剪枝：长度为奇数直接返回 false
        if (s.length() % 2 != 0) {
            return false;
        }

        // 建议使用 ArrayDeque 代替 Stack，因为 Stack 是线程安全的古老类，性能稍差
        Deque<Character> stack = new ArrayDeque<>();

        for (char c : s.toCharArray()) {
            // 技巧：遇到左括号，推入其对应的“期望右括号”
            if (c == '(') {
                stack.push(')');
            } else if (c == '[') {
                stack.push(']');
            } else if (c == '{') {
                stack.push('}');
            } else {
                // 遇到右括号时，执行判断：
                // 1. 如果栈为空，说明右括号多余，返回 false
                // 2. 弹出栈顶，如果栈顶字符（期望的右括号）与当前字符不一致，返回 false
                if (stack.isEmpty() || stack.pop() != c) {
                    return false;
                }
            }
        }

        // 循环结束，必须保证栈内没有剩余的左括号
        return stack.isEmpty();
    }

    public static void main(String[] args) {
        // --- 示例 1 测试 ---
        String s1 = "()";
        System.out.println("示例 1 输入: " + s1);
        boolean res1 = isValid(s1);
        System.out.println("示例 1 输出: " + res1); // 预期: true
        System.out.println("-----------------------------");

        // --- 示例 2 测试 ---
        String s2 = "()[]{}";
        System.out.println("示例 2 输入: " + s2);
        boolean res2 = isValid(s2);
        System.out.println("示例 2 输出: " + res2); // 预期: true
        System.out.println("-----------------------------");

        // --- 示例 3 测试 ---
        String s3 = "(]";
        System.out.println("示例 3 输入: " + s3);
        boolean res3 = isValid(s3);
        System.out.println("示例 3 输出: " + res3); // 预期: false
        System.out.println("-----------------------------");

        // --- 示例 4 测试 ---
        String s4 = "([)]";
        System.out.println("示例 4 输入: " + s4);
        boolean res4 = isValid(s4);
        System.out.println("示例 4 输出: " + res4); // 预期: false
        System.out.println("-----------------------------");

        // --- 示例 5 测试 ---
        String s5 = "{[]}";
        System.out.println("示例 5 输入: " + s5);
        boolean res5 = isValid(s5);
        System.out.println("示例 5 输出: " + res5); // 预期: true
    }
}
```
