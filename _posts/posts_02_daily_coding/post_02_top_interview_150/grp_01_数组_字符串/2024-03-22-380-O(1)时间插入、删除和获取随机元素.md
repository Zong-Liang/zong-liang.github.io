---
title: 380-O(1)时间插入、删除和获取随机元素
date: 2024-03-22 06:00:00 +0800
categories: [Daily Coding, Top Interview 150, 数组_字符串]
tags: [数组_字符串]
toc: true
math: true
pin: false
render_with_liquid: false
image:
  path: https://cdn.jsdelivr.net/gh/Zong-Liang/blog_images/blog/2024/daily_coding/20251121222634446.png
  lqip: data:image/webp;base64,UklGRpoAAABXRUJQVlA4WAoAAAAQAAAADwAABwAAQUxQSDIAAAARL0AmbZurmr57yyIiqE8oiG0bejIYEQTgqiDA9vqnsUSI6H+oAERp2HZ65qP/VIAWAFZQOCBCAAAA8AEAnQEqEAAIAAVAfCWkAALp8sF8rgRgAP7o9FDvMCkMde9PK7euH5M1m6VWoDXf2FkP3BqV0ZYbO6NA/VFIAAAA
---

好的，这是图片中问题的整理以及符合要求的 Java 8 解答。

### 题目：380. O(1) 时间插入、删除和获取随机元素

**描述**
实现 `RandomizedSet` 类：

- `RandomizedSet()` 初始化 `RandomizedSet` 对象
- `bool insert(int val)` 当元素 `val` 不存在时，向集合中插入该项，并返回 `true` ；否则，返回 `false` 。
- `bool remove(int val)` 当元素 `val` 存在时，从集合中移除该项，并返回 `true` ；否则，返回 `false` 。
- `int getRandom()` 随机返回现有集合中的一项（测试用例保证调用此方法时集合中至少存在一个元素）。每个元素应该有 **相同的概率** 被返回。

你必须实现类的所有函数，并满足每个函数的 **平均** 时间复杂度为 `O(1)` 。

**示例:**

- **输入**
  `["RandomizedSet", "insert", "remove", "insert", "getRandom", "remove", "insert", "getRandom"]`
  `[[], [1], [2], [2], [], [1], [2], []]`
- **输出**
  `[null, true, false, true, 2, true, false, 2]`
  _(getRandom 的输出可能是 1 或 2)_

**提示:**

- `-2^31 <= val <= 2^31 - 1`
- 最多调用 `insert`、`remove` 和 `getRandom` 函数 `2 * 10^5` 次
- 在调用 `getRandom` 方法时，数据结构中 **至少** 存在一个元素。

---

### 赛码网格式 Java 8 代码

_注意：本题要求实现一个类。为了符合赛码网的格式要求，我们将 `RandomizedSet` 实现为一个独立的类，并在 `Main` 类的 `main` 方法中调用它来展示测试用例。_

```java
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Random;

/**
 * RandomizedSet 类，支持 O(1) 时间的插入、删除和随机获取。
 */
class RandomizedSet {
    // 使用 List 存储元素，以支持 O(1) 的随机访问
    private List<Integer> list;
    // 使用 Map 存储元素值到其在 List 中索引的映射，以支持 O(1) 的查找
    private Map<Integer, Integer> map;
    private Random random;

    /** 初始化 RandomizedSet 对象 */
    public RandomizedSet() {
        list = new ArrayList<>();
        map = new HashMap<>();
        random = new Random();
    }

    /** 当元素 val 不存在时，向集合中插入该项 */
    public boolean insert(int val) {
        if (map.containsKey(val)) {
            return false;
        }
        // 将元素添加到 List 末尾
        list.add(val);
        // 在 Map 中记录元素值和它的索引
        map.put(val, list.size() - 1);
        return true;
    }

    /** 当元素 val 存在时，从集合中移除该项 */
    public boolean remove(int val) {
        if (!map.containsKey(val)) {
            return false;
        }

        // 核心技巧：为了 O(1) 删除，将要删除的元素与 List 的最后一个元素交换
        int indexToRemove = map.get(val);
        int lastElement = list.get(list.size() - 1);

        // 交换
        list.set(indexToRemove, lastElement);
        // 更新原最后一个元素在 Map 中的索引
        map.put(lastElement, indexToRemove);

        // 删除 List 的最后一个元素 (现在它要么是要删除的元素，要么是重复的)
        list.remove(list.size() - 1);
        // 从 Map 中移除要删除的元素
        map.remove(val);

        return true;
    }

    /** 随机返回现有集合中的一项 */
    public int getRandom() {
        // 从 List 中随机获取一个元素
        return list.get(random.nextInt(list.size()));
    }
}

public class Main {
    // main 方法放最下面
    public static void main(String[] args) {
        // 示例测试
        System.out.println("--- 运行示例 ---");
        RandomizedSet randomizedSet = new RandomizedSet();
        System.out.println("操作: new RandomizedSet() -> null");

        System.out.println("操作: insert(1) -> " + randomizedSet.insert(1));
        System.out.println("操作: remove(2) -> " + randomizedSet.remove(2));
        System.out.println("操作: insert(2) -> " + randomizedSet.insert(2));
        System.out.println("操作: getRandom() -> " + randomizedSet.getRandom());
        System.out.println("操作: remove(1) -> " + randomizedSet.remove(1));
        System.out.println("操作: insert(2) -> " + randomizedSet.insert(2));
        System.out.println("操作: getRandom() -> " + randomizedSet.getRandom());
    }
}
```
