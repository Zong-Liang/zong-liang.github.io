---
title: "Git使用规范"
date: 2025-09-16 08:50:47 +0800
categories: [实习日常, Git使用规范]
tags: [实习日常, Git使用规范]
pin: false
toc: true
math: true
---

## 核心理念

*   **分支驱动开发**：任何新的开发工作（功能、修复）都必须在独立的分支上进行，绝不允许直接向主分支提交代码。
*   **代码评审**：所有代码在合并入主分支前，必须经过至少一位同事的审查（Code Review）。
*   **历史清晰**：保持 `main` 和 `develop` 分支的提交历史是线性的、干净的和有意义的。

---

## 一、分支模型策略 (Branching Model)

企业开发中最常用的是 **Git Flow** 的简化或变种模型。它定义了不同分支的角色和生命周期。

### 1. 主要分支 (Permanent Branches)

这两条分支是项目的核心，生命周期是永久的。

*   `main` (或 `master`)
    *   **用途**：存放随时可以部署到生产环境的、最稳定的代码。
    *   **规则**：
        *   **严禁**直接在此分支上进行任何提交。
        *   所有代码都必须从其他分支（通常是 `release` 或 `hotfix`）合并而来。
        *   每一次合并到 `main` 分支都应该对应一个版本号，并打上一个 Git 标签（Tag）。

*   `develop`
    *   **用途**：作为所有功能开发的集成主分支。它包含了所有已完成并测试的功能，是下一个发布版本的基础。
    *   **规则**：
        *   **严禁**直接在此分支上进行提交。
        *   所有代码都必须从功能分支（`feature/*`）合并而来。
        *   这个分支的代码通常会部署到开发或测试环境，用于功能集成测试。

### 2. 辅助分支 (Temporary Branches)

这些分支是临时的，完成使命后就会被删除。

*   **功能分支 (Feature Branch)**
    *   **命名规范**：`feature/TICKET-ID-short-description`
        *   `TICKET-ID`：关联的项目管理工具（如 JIRA、禅道）中的任务编号。
        *   `short-description`：用简短的英文描述功能，多个单词用连字符 `-` 连接。
    *   **示例**：`feature/PROJ-123-user-login-auth`
    *   **创建自**：`develop` 分支。
    *   **最终合并至**：`develop` 分支。

*   **修复分支 (Bugfix Branch)**
    *   **命名规范**：`bugfix/TICKET-ID-short-description`
    *   **示例**：`bugfix/PROJ-456-fix-login-button-style`
    *   **创建自**：`develop` 分支（用于修复下一个版本中的 Bug）。
    *   **最终合并至**：`develop` 分支。

*   **热修复分支 (Hotfix Branch)**
    *   **用途**：专门用于紧急修复线上生产环境的 Bug。
    *   **命名规范**：`hotfix/TICKET-ID-short-description`
    *   **示例**：`hotfix/PROJ-789-fix-payment-api-null-pointer`
    *   **创建自**：`main` 分支（必须从出问题的线上版本代码创建）。
    *   **最终合并至**：`main` 和 `develop` 两个分支（确保修复也被同步到开发线）。

*   **预发布分支 (Release Branch)**
    *   **用途**：当 `develop` 分支的功能储备足够发布一个新版本时，创建 `release` 分支进行发布前的准备工作（如最后的 Bug 修复、版本号更新、文档生成等）。在此分支上不再添加新功能。
    *   **命名规范**：`release/vX.Y.Z` (例如: `release/v1.2.0`)
    *   **创建自**：`develop` 分支。
    *   **最终合并至**：`main` 和 `develop` 两个分支。

## 二、提交信息规范 (Commit Message)

清晰的 Commit Message 是代码可追溯性的关键。推荐使用 **Conventional Commits** 规范。

### 格式

```
<type>(<scope>): <subject>
<BLANK LINE>
<body>
<BLANK LINE>
<footer>
```

*   **`type` (必需)**：说明提交的类别。
    *   `feat`: 新功能 (feature)
    *   `fix`: 修复 bug
    *   `docs`: 仅仅修改了文档
    *   `style`: 代码格式修改，不影响代码逻辑 (如空格、分号等)
    *   `refactor`: 代码重构，既不是新增功能，也不是修复 bug
    *   `test`: 增加或修改测试用例
    *   `chore`: 构建过程或辅助工具的变动（如修改 `.gitignore`）

*   **`scope` (可选)**：说明影响的范围（如模块、组件名）。

*   **`subject` (必需)**：简短描述，不超过 50 个字符。使用祈使句，如 "Add user login" 而不是 "Added user login"。

*   **`body` (可选)**：更详细的描述，解释修改的动机和背景。

*   **`footer` (可选)**：用于记录**不兼容的变更 (Breaking Change)** 或**关闭的 Issue** (如 `Closes #123`)。

### 示例

```
feat(auth): add JWT-based user authentication

Implement a new endpoint /api/login that accepts username and password,
and returns a JSON Web Token (JWT) upon successful authentication.

Closes PROJ-123
```

## 三、日常开发工作流

1.  **开始新任务**
    *   同步最新的主分支：`git checkout develop && git pull origin develop`
    *   创建新的功能分支：`git checkout -b feature/PROJ-123-new-feature`

2.  **开发与提交**
    *   编写代码，并进行**小步、原子化**的提交。一个提交只做一件事情。
    *   `git add .`
    *   `git commit -m "feat(module): add new function"`

3.  **保持与主干同步**
    *   为了避免最后合并时产生巨大的冲突，应**定期**将 `develop` 分支的最新变更同步到自己的功能分支。
    *   推荐使用 `rebase` 保持历史记录的整洁：
        ```bash
        git fetch origin develop
        git rebase origin/develop
        ```
    *   如果遇到冲突，解决冲突后执行 `git rebase --continue`。

4.  **提交代码审查**
    *   当功能开发完成并通过自测后，将分支推送到远程仓库：
        `git push origin feature/PROJ-123-new-feature`
    *   在 GitLab/GitHub/Gerrit 等平台上创建一个 **Pull Request (PR)** 或 **Merge Request (MR)**，目标分支选择 `develop`。

## 四、代码审查 (Code Review) 与合并

### Pull Request (PR) 规范

1.  **标题清晰**：PR 的标题应该能概括这次变更的核心内容。
2.  **描述详尽**：
    *   **Why**：为什么要做这个变更？解决了什么问题？关联哪个任务 (链接到 JIRA Ticket)。
    *   **What**：具体做了哪些修改？
    *   **How**：实现思路或关键的技术点。
    *   **Test**：如何测试？有无需要注意的测试点？
3.  **指定审查者 (Reviewer)**：通常会指定 1-2 名同事进行审查。
4.  **自动化检查**：确保 PR 通过了所有 CI/CD 流程中的自动化检查（如单元测试、代码风格检查、安全扫描）。

### 合并规范

1.  **至少一人批准**：必须得到至少一位 Reviewer 的 "Approve" 才能合并。
2.  **解决所有讨论**：所有 Reviewer 提出的问题都应该被解决或回复。
3.  **选择合并策略**：
    *   **Squash and Merge (推荐)**：将该功能分支上的所有提交合并成一个提交，再合入 `develop` 分支。这样可以让 `develop` 的历史非常干净，每一个提交都是一个完整的功能或修复。
    *   **Rebase and Merge**：将功能分支上的所有提交变基到 `develop` 分支的最新 commit 之后，形成一条直线，没有分叉。
4.  **删除已合并分支**：合并后，应立即删除远程和本地的临时分支，保持仓库整洁。

## 五、禁止项 (Forbidden Actions)

1.  **严禁向 `main` 和 `develop` 分支执行 `git push -f` (强制推送)**。
2.  **严禁直接向 `main` 和 `develop` 分支提交代码**。
3.  **不要提交未完成或无法正常工作的代码**到共享分支。
4.  **避免在 `.gitignore` 文件未配置的情况下提交个人 IDE 配置、编译产物、日志文件等**。

遵循以上规范，可以构建一个高效、可靠、可追溯的开发流程，让团队协作如丝般顺滑。
